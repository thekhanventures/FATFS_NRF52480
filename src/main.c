#include <zephyr/kernel.h>
#include <zephyr/sys/printk.h>
#include <zephyr/device.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdbool.h>
#include <string.h>
#include "uzlib.h"

void exit_error(const char *what)
{
    printk("ERROR: %s\n", what);
    exit(1);
}

void main(void)
{
    const uint32_t data[] = {
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01,
        3.188720047473907471e-01,
        3.492407798767089844e-01,
        4.023861289024353027e-01,
        4.392624795436859131e-01,
        4.501084685325622559e-01,
        4.620390534400939941e-01,
        4.750542342662811279e-01,
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01,
        3.188720047473907471e-01,
        3.492407798767089844e-01,
        4.023861289024353027e-01,
        4.392624795436859131e-01,
        4.501084685325622559e-01,
        4.620390534400939941e-01,
        4.750542342662811279e-01,
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01,
        3.188720047473907471e-01,
        3.492407798767089844e-01,
        4.023861289024353027e-01,
        4.392624795436859131e-01,
        4.501084685325622559e-01,
        4.620390534400939941e-01,
        4.750542342662811279e-01,
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01,
        3.188720047473907471e-01,
        3.492407798767089844e-01,
        4.023861289024353027e-01,
        4.392624795436859131e-01,
        4.501084685325622559e-01,
        4.620390534400939941e-01,
        4.750542342662811279e-01,
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01,
        3.188720047473907471e-01,
        3.492407798767089844e-01,
        4.023861289024353027e-01,
        4.392624795436859131e-01,
        4.501084685325622559e-01,
        4.620390534400939941e-01,
        4.750542342662811279e-01,
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01,
        3.188720047473907471e-01,
        3.492407798767089844e-01,
        4.023861289024353027e-01,
        4.392624795436859131e-01,
        4.501084685325622559e-01,
        4.620390534400939941e-01,
        4.750542342662811279e-01,
        9.739696383476257324e-01,
        9.132320880889892578e-01,
        8.655097484588623047e-01,
        8.232104182243347168e-01,
        7.462038993835449219e-01,
        6.420824527740478516e-01,
        5.477223396301269531e-01,
        4.262472987174987793e-01,
        3.253796100616455078e-01,
        2.798264622688293457e-01,
        2.288503199815750122e-01,
        1.366594433784484863e-01,
        4.772234335541725159e-02,
        1.084598712623119354e-02,
        1.008676812052726746e-01,
        1.887201666831970215e-01,
        2.277657240629196167e-01,
        2.407809048891067505e-01,
        2.570498883724212646e-01,
        2.635574936866760254e-01,
        2.939262390136718750e-01
        
    };

    printk("tgzip - example from the uzlib library\n\n");


    size_t uncompressed_size = sizeof(data)/ sizeof(data[0]);
    
    for (int i = 0; i < 100; i++) {
                /* -- compress data -- */

        struct uzlib_comp comp = {0};
        comp.dict_size = 32768;
        comp.hash_bits = 12;
        size_t hash_size = sizeof(uzlib_hash_entry_t) * (1 << comp.hash_bits);
        comp.hash_table = malloc(hash_size);
        memset(comp.hash_table, 0, hash_size);

        zlib_start_block(&comp);
        uzlib_compress(&comp, (const unsigned char *)data, sizeof(data));
        zlib_finish_block(&comp);

        printk("Compressed size: %u bytes\n", comp.outlen);
        //int compression_rate = ((((uncompressed_size * sizeof(int))/(float)comp.outlen) - 1 )*100);
        int compression_rate = ((uncompressed_size)/comp.outsize);
        printk("compressed size: %d\n", (comp.outsize));
        printk("uncompressed_size: %d\n", (uncompressed_size));
        printk("Compression rate: %d\n", (compression_rate));
                // Your process code goes here
    }
    return 0;

    
}
